<!DOCTYPE html>
<html>
<head>
    <!--librerie-->
    <script src="http://127.0.0.1:8080/js/three.js"></script>

    <!--moduli-->
    <script src="http://127.0.0.1:8080/js/initPointLock.js"></script>    
    <script src="http://127.0.0.1:8080/js/MovementControl.js"></script>
    <script src="http://127.0.0.1:8080/js/blenderImporter.js"></script>
    <script src="http://127.0.0.1:8080/js/ManopolaAnimation.js"></script>
    <script src="http://127.0.0.1:8080/js/PorteAnimation.js"></script>
    <script src="http://127.0.0.1:8080/js/Clickable.js"></script>
    <script src="http://127.0.0.1:8080/js/video.js"></script>
    <script src="http://127.0.0.1:8080/js/debugAxes.js"></script>
    <script src="http://127.0.0.1:8080/js/Dalek.js"></script>
    <script src="http://127.0.0.1:8080/js/Interno.js"></script>
    <script src="http://127.0.0.1:8080/js/Esterno.js"></script>

    <!-- CSS -->
    <link href="http://127.0.0.1:8080/style/tardis.css" rel="stylesheet" type="text/css">
</head>
<body>
    <div id="blocker">
        <div id="instructions">
            <span id="spanTitolo">TARDIS</span>
            <br/>
            frase a caso
            <br/>
            <img src=""/> <!-- Mettere l'img della repository -->
         </div>
    </div>
      
    <script>

        var camera, scene, sceneEsterno, renderer;
        var geometry, material, mesh;
        var controls ,time = Date.now();
        var ray;
        var clickable;
        var blocker = document.getElementById( 'blocker' );
        var instructions = document.getElementById( 'instructions' );
        var cylinder1, cylinder2, cylinder3, cylinder4; 
        var schermo1, schermo2, schermo3;
        var collidableMeshList;
        var manopolaAnimation1;
        var manopolaAnimation2;
        var loadV, loadV2;
        var line;
        var dalek;
        var dalekC;

        var obEsterno, obInterno;
        var interno = false;

        initPointLock(blocker, instructions);

        init();
        animate();

        function init(){
            camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 10000 );
            
            scene = new THREE.Scene();
            
            controls = new THREE.PointerLockControls( camera );

            /** CLICKABLE **/
            clickable = new Clickable(controls); //instazio la classe clickable passandogli la variabile legata a PointerLockControls
            document.addEventListener( 'mousedown', clickable.onDocumentMouseDown, false ); // aggiungo l'evento mousedown
            /*******/

            scene.add( controls.getObject() );

            ray = new THREE.Raycaster();
            ray.ray.direction.set( 0, -1, 0 );

            //DEBUG-Axes
            axes = buildAxes( 1000 );
            scene.add( axes );

            renderer = new THREE.WebGLRenderer({antialias: true});
            renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.shadowMapEnabled = true;
            document.body.appendChild( renderer.domElement );

            window.addEventListener( 'resize', onWindowResize, false );

            initEsterno();
            scene.add(obEsterno);
            //initInterno();
            //scene.add(obInterno);
            //interno=true;
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize( window.innerWidth, window.innerHeight );
        }

        function animate() {
            requestAnimationFrame( animate );
                    
            ray.ray.origin.copy( controls.getObject().position );
            ray.ray.origin.y -= 10;

            controls.update( Date.now() - time );

            renderer.render( scene, camera );

            time = Date.now();

            if (interno)
                animateInterno();
            else
                animateEsterno();
        }

        function removeEntity(object) {
            scene.remove( object );
        }

    </script>
</body>
</html>